---
title: "Numeracy, Modelling and Data Management"
author: "Mike Spencer"
date: "27/03/2015"
output:
  html_document:
    highlight: tango
    theme: united
    toc: yes
---

## Introduction

Welcome to the final session of the doctoral training course: numeracy, modelling and data management. This course was originally scheduled to cover [GDAL](http://www.gdal.org/), and it will, but as it has been postponed by a week we've decided to include a general wrap up of the course and show some example work flows.

### This document

This document has been written using [R markdown](http://rmarkdown.rstudio.com/), which I understand Mark Naylor showed you. R markdown is similar to [Python notebooks](http://ipython.org/notebook.html), both of which allow you to write documents and embed code and results within them. R markdown can write output to html, pdf or word formats. R markdown works best for me as an electronic lab notebook, so all my analysis happens within R markdown and I write comments on what I find as I go along. This way, when you're writing that Nature paper and come back to find the code that generated your plot, it's all available within the same document. Your hunting will be vastly reduced!

Writing in markdown is really simple, plain text is just plain text. Here's a handy cheat sheet for headings and highlighting: http://blog.rstudio.org/2014/08/01/the-r-markdown-cheat-sheet/. If you want to do something more complicated it will happily accept html code (if that's what you're wrapping it to) or LaTeX. The easiest way to write in R markdown is using the R IDE [RStudio](http://www.rstudio.com/products/rstudio/download/), this is freely available for Linux, Windows and Mac. It's also installed on the school server, burn, open it by typing *rstudio* in a terminal.

This R markdown html is hosted as a github page, you can view the repository here: https://github.com/mikerspencer/training/tree/gh-pages which also includes the raw markdown file (Rmd) this webpage is based on.

I'm going to cover a few things in this session and talk about specific tools, these are the ones I use. They're certainly not the only ones available, but they are what I know. If you'd like to talk about other options, advantages and disadvantages drop by and see me in the Grant (rm 400) or [email](http://www.ed.ac.uk/schools-departments/geosciences/people?indv=2920&cw_xml=student.html). So here's what I'll cover:

* File structure
* Backups (rsync)
* Version control (git)
* Command line (bash)
* Programming (R)
* Spatial data
      + GIS (QGIS, GRASS)
      + GDAL (R, GIS)
      + Programming (R)
* Databases (SQLite)
* Writing (markdown & LaTeX)

The key, for me, from these tools is that they help to make your research repeatable. This is really important holistically, but even on a personal level; if you need to make a few changes to a graph, table, paper... then all your analysis can be repeated with the click of a button - you don't have to remember it all in your head!


## File structure

I'm not going to say much about this, but do think about it. Having a consistent structure means you always know where to look for something. I wrote some ideas on my blog: https://scottishsnow.wordpress.com/2014/08/28/electronic-organisation-of-projects/


## Backups

Backing up your work is crucial. If you lose everything pity from your colleagues will not help get it back. Hopefully most of you will be working on the school server (adder/m drive), this is backed up. Another option could be that you work on your desktop and backup to the work server. If you do this copying folders across is so 1995. Use backup software like [rsync](http://en.wikipedia.org/wiki/Rsync) which scans for changes in files and only copies over what is needed. It's very fast. Here's an example that you would run in a bash terminal:

```{r backup, engine="bash", eval=F}
sudo rsync --delete --exclude='/.*/' --exclude='/dir/temp/' -azv -e ssh /home/s1066252 s1066252@adder.geos.ed.ac.uk:/home/s1066252/
```

The above example doesn't just work within the school, you can also use it at home or wherever. Remember to change the student number to your own!


## Version control

When I started using Git it totally revolutionised the way I worked. When I changed documents or code I no longer had to remember to make a copy before a major revision, or hold the previous version in my head when I made a minor revision. Each previous version was managed with a tag saying what I'd done to it. My mind was free to concentrate on what I wanted to achieve, not on avoiding breaking what I had (and not being able to salvage it).

Anything you write in plain text and change should be managed in version control. Most importantly this includes programming code and LaTeX documents. A tip for the latter is put each sentence on a new line, it will make it easier to track what changes. So long as you don't leave empty lines LaTeX will wrap these all to the same paragraph.

There are a few version control software programmes out there. I use Git, it's very widely used and there are a couple of great web hosting facilities for your repositories. The most well known of these is [GitHub](https://github.com/), another is [Bitbucket](https://bitbucket.org/). I think Bitbucket has a better documented and laid out web interface, but this is likely personal preference. The real difference between the two is what you get for free. GitHub allows you to have unlimited collaborators and host webpages (like this one), but charges for private repositories. Bitbucket has free private repositories, but charges for more than 10 people in a team, although it seems this is waived if you sign up with your academic email address. I use GitHub and Bitbucket for different things, I mainly use GitHub for public work and Bitbucket for my research.

You've had a dedicated session on Git, so I wont cover it in much detail here. I will say this is a great resource: http://rogerdudler.github.io/git-guide/, and the code below is what I use 99% of the time (anything else I have to look up):

```{r git, engine="bash", eval=F}
# -----------------------------------
# Setting up
# -----------------------------------
# From scratch
# Initialise your folder
git init
# Add the remote repo
git add remote ...

# Existing project, new computer
git clone ...

# -----------------------------------
# Day to day
# -----------------------------------
# Change directory
cd ~/working/directory/repo
# Track files
git add --all
# Commit with message
git commit -m "what I did"
# Send to remote repo
git push
```


## Command line


If you're working with lots of files or big ones the terminal is your friend. You've already used it for managing your version control repos and running backups, but it can do so much more. Here are some examples you might not have covered previously:

```{r bash, engine="bash", eval=F}
# Download data from a remote ftp
# This takes files that match the h17v0 string, but that have the number 2 or 3 afterwards.
# Actual examples for downloading MODIS snow cover satellite images for Scotland.
lftp -c 'open -e "mirror -I *h17v0[23]*hdf . ." ftp://n5eil01u.ecs.nsidc.org/SAN/MOSA/MYD10A1.005/'

# New directory
mkdir test

# List files in a directory
ls

# Show the first few files of a directory (useful if it has many files)
ls | head
```

You can also write programmes to do repetetive tasks, like resizing images (the below relies on ImageMagick)

```{r bash images, engine="bash", eval=F}
# -----------------------------------
# Save the below in a file called resizer.sh in a folder of pictures you want to make smaller
# -----------------------------------

mkdir ./small
for file in ./*
do convert $file -define jpeg:extent=0.3MB ./small/$file
done

# Comments
# Line 1 creates a sub-directory called small
# Line 2 lists all the files in the working directory (make sure it only has jpgs)
# Line 3 makes a copy of Line 2 files in small that are less than 0.5 MB in size
# Line 4 stops the script


# -----------------------------------
# Run these
# -----------------------------------
cd ~/Picture/folder
sh resizer.sh
```

I use bash to manage my Linux computers, so I can reinstall all programmes into a fresh build with the minimum of hassle, there's an example script here: https://scottishsnow.wordpress.com/software/

## Programming



## Spatial data

### GIS (QGIS, GRASS)
### GDAL (R, GIS)
### Programming (R)

## Databases

## Writing (markdown & LaTeX)